<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodGuard - Flood Monitoring & Alert System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒŠ</text></svg>">
    {% load static %}
    <link rel="stylesheet" href="{% static 'dashboard/css/styles.css' %}">
    <script>
        // Dashboard JavaScript for live data updates
        document.addEventListener('DOMContentLoaded', function() {
            // Load all widgets on page load
            refreshStats();
            refreshAlerts();
            refreshReports();
            refreshWeather();
            refreshSatellite();
            refreshSensors();

            // Auto-refresh every 30 seconds
            setInterval(function() {
                refreshStats();
                refreshAlerts();
                refreshReports();
                refreshWeather();
                refreshSatellite();
                refreshSensors();
            }, 30000);
        });

        function refreshStats() {
            fetch('/api/dashboard/widgets/stats/')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-alerts').textContent = data.total_alerts;
                    document.getElementById('total-reports').textContent = data.total_reports;
                    document.getElementById('critical-alerts').textContent = data.critical_alerts;
                    document.getElementById('recent-activity').textContent = data.recent_alerts + data.recent_reports;
                })
                .catch(error => console.error('Error loading stats:', error));
        }

        function refreshAlerts() {
            fetch('/api/dashboard/widgets/alerts/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('alerts-content');
                    if (!data.alerts || data.alerts.length === 0) {
                        container.innerHTML = '<div class="no-data">No active alerts</div>';
                        return;
                    }
                    container.innerHTML = data.alerts.map(alert => `
                        <div class="alert-item ${alert.alert_level ? alert.alert_level.toLowerCase() : 'moderate'}">
                            <div class="alert-title">${alert.title || 'Untitled Alert'}</div>
                            <div class="alert-meta">${alert.location || 'Unknown Location'} â€¢ ${alert.created_at ? new Date(alert.created_at).toLocaleDateString() : 'Unknown Date'}</div>
                            <div class="alert-level">${alert.alert_level || 'MODERATE'}</div>
                        </div>
                    `).join('');
                })
                .catch(error => console.error('Error loading alerts:', error));
        }

        function refreshReports() {
            fetch('/api/dashboard/widgets/reports/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('reports-content');
                    if (!data.reports || data.reports.length === 0) {
                        container.innerHTML = '<div class="no-data">No community reports</div>';
                        return;
                    }
                    container.innerHTML = data.reports.map(report => `
                        <div class="report-item ${report.severity ? report.severity.toLowerCase() : 'moderate'}">
                            <div class="report-title">${report.title || 'Untitled Report'}</div>
                            <div class="report-meta">${report.report_type || 'Unknown'} â€¢ ${report.location || 'Unknown Location'}</div>
                            <div class="report-severity">${report.severity || 'MODERATE'}</div>
                        </div>
                    `).join('');
                })
                .catch(error => console.error('Error loading reports:', error));
        }

        function refreshWeather() {
            fetch('/api/dashboard/widgets/weather/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('weather-content');
                    if (!data.weather || data.weather.length === 0) {
                        container.innerHTML = '<div class="no-data">No weather data available</div>';
                        return;
                    }
                    container.innerHTML = data.weather.slice(0, 3).map(weather => `
                        <div class="weather-item">
                            <div class="weather-location">${weather.location || 'Unknown'}</div>
                            <div class="weather-temp">${weather.temperature ? weather.temperature + 'Â°C' : 'N/A'}</div>
                            <div class="weather-details">
                                ğŸ’§ ${weather.humidity ? weather.humidity + '%' : 'N/A'} â€¢ ğŸŒ§ï¸ ${weather.precipitation || 0}mm
                            </div>
                        </div>
                    `).join('');
                })
                .catch(error => console.error('Error loading weather:', error));
        }

        function refreshSatellite() {
            fetch('/api/dashboard/widgets/satellite/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('satellite-content');
                    if (!data.satellite_data || data.satellite_data.length === 0) {
                        container.innerHTML = '<div class="no-data">No satellite data available</div>';
                        return;
                    }
                    container.innerHTML = data.satellite_data.slice(0, 3).map(sat => `
                        <div class="satellite-item ${sat.flood_risk_level || 'low'}">
                            <div class="satellite-type">${sat.satellite ? sat.satellite.replace('_', ' ') : 'Unknown'}</div>
                            <div class="satellite-location">${sat.location || 'Unknown'}</div>
                            <div class="satellite-risk">Risk: ${sat.flood_risk_level || 'Unknown'}</div>
                        </div>
                    `).join('');
                })
                .catch(error => console.error('Error loading satellite data:', error));
        }

        function refreshSensors() {
            fetch('/api/dashboard/widgets/sensors/')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('sensors-content');
                    if (!data.sensors || data.sensors.length === 0) {
                        container.innerHTML = '<div class="no-data">No sensor data available</div>';
                        return;
                    }
                    container.innerHTML = data.sensors.slice(0, 4).map(sensor => `
                        <div class="sensor-item">
                            <div class="sensor-type">${sensor.sensor_type ? sensor.sensor_type.replace('_', ' ') : 'Unknown'}</div>
                            <div class="sensor-value">${sensor.value || 'N/A'} ${sensor.unit || ''}</div>
                            <div class="sensor-location">${sensor.location || 'Unknown'}</div>
                        </div>
                    `).join('');
                })
                .catch(error => console.error('Error loading sensors:', error));
        }

        function emergencyCall() {
            alert('ğŸš¨ EMERGENCY: Please call your local emergency services immediately!\n\nEmergency Hotline: 911 (US) or your local emergency number.');
        }
    </script>
</head>
<body>
    <div class="sidebar">
        <h2>ğŸŒŠ FloodGuard</h2>
        <ul>
            <li><a href="/" class="active">ğŸ  Dashboard</a></li>
            <li><a href="/api/alerts/" target="_blank">ğŸ“¢ Alerts</a></li>
            <li><a href="/api/community/reports/" target="_blank">ğŸ‘¥ Community Reports</a></li>
            <li><a href="/api/dashboard/widgets/stats/" target="_blank">ğŸ“Š Statistics</a></li>
            <li><a href="/api/dashboard/widgets/weather/" target="_blank">ğŸŒ¤ï¸ Weather Data</a></li>
            <li><a href="/api/dashboard/widgets/sensors/" target="_blank">ğŸ“¡ Sensor Readings</a></li>
            <li><a href="/admin/" target="_blank">ğŸ”§ Admin Panel</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>ğŸŒŠ FloodGuard</h1>
            <p>Advanced Flood Monitoring & Community Alert System</p>
        </div>

        <!-- Live Dashboard Widgets Section -->
        <div class="dashboard-widgets">
            <h2>ğŸ“Š Live Dashboard</h2>
            <div class="widgets-grid">
                <!-- Statistics Widget -->
                <div class="widget-card stats-widget">
                    <div class="widget-header">
                        <h3>ğŸ“ˆ System Statistics</h3>
                        <span class="widget-refresh" onclick="refreshStats()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="stats-content">
                        <div class="stat-item">
                            <span class="stat-label">Active Alerts:</span>
                            <span class="stat-value" id="total-alerts">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Community Reports:</span>
                            <span class="stat-value" id="total-reports">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Critical Alerts:</span>
                            <span class="stat-value critical" id="critical-alerts">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Recent Activity (7 days):</span>
                            <span class="stat-value" id="recent-activity">-</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Alerts Widget -->
                <div class="widget-card alerts-widget">
                    <div class="widget-header">
                        <h3>ğŸš¨ Recent Alerts</h3>
                        <span class="widget-refresh" onclick="refreshAlerts()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="alerts-content">
                        <div class="loading">Loading alerts...</div>
                    </div>
                </div>

                <!-- Community Reports Widget -->
                <div class="widget-card reports-widget">
                    <div class="widget-header">
                        <h3>ğŸ‘¥ Community Reports</h3>
                        <span class="widget-refresh" onclick="refreshReports()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="reports-content">
                        <div class="loading">Loading reports...</div>
                    </div>
                </div>

                <!-- Weather Widget -->
                <div class="widget-card weather-widget">
                    <div class="widget-header">
                        <h3>ğŸŒ¤ï¸ Weather Data</h3>
                        <span class="widget-refresh" onclick="refreshWeather()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="weather-content">
                        <div class="loading">Loading weather data...</div>
                    </div>
                </div>

                <!-- Satellite Monitoring Widget -->
                <div class="widget-card satellite-widget">
                    <div class="widget-header">
                        <h3>ğŸ›°ï¸ Satellite Data</h3>
                        <span class="widget-refresh" onclick="refreshSatellite()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="satellite-content">
                        <div class="loading">Loading satellite data...</div>
                    </div>
                </div>

                <!-- Sensor Readings Widget -->
                <div class="widget-card sensors-widget">
                    <div class="widget-header">
                        <h3>ğŸ“¡ Sensor Readings</h3>
                        <span class="widget-refresh" onclick="refreshSensors()">ğŸ”„</span>
                    </div>
                    <div class="widget-content" id="sensors-content">
                        <div class="loading">Loading sensor data...</div>
                    </div>
                </div>

                <!-- Quick Actions Widget -->
                <div class="widget-card actions-widget">
                    <div class="widget-header">
                        <h3>âš¡ Quick Actions</h3>
                    </div>
                    <div class="widget-content">
                        <button class="action-btn" onclick="window.open('/dashboard/alerts/', '_blank')">
                            ğŸ“¢ View Alerts & Satellite
                        </button>
                        <button class="action-btn" onclick="window.open('/api/community/reports/', '_blank')">
                            ğŸ‘¥ View Reports
                        </button>
                        <button class="action-btn" onclick="window.open('/admin/', '_blank')">
                            ğŸ”§ Admin Panel
                        </button>
                        <button class="action-btn emergency" onclick="emergencyCall()">
                            ğŸš¨ Emergency
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flood Safety Tips Section -->
        <div class="tips-section">
            <h2>ğŸ›¡ï¸ Flood Safety Guidelines</h2>
            <div class="tips-container">
                <div class="tip-card animate-fade-in">
                    <div class="tip-icon">ğŸ </div>
                    <h3>Prepare Your Home</h3>
                    <p>Move furniture and valuables to higher ground. Seal basement windows and doors with sandbags or plastic sheeting.</p>
                </div>
                <div class="tip-card animate-slide-up">
                    <div class="tip-icon">ğŸš—</div>
                    <h3>Emergency Kit</h3>
                    <p>Prepare an emergency kit with water, food, medications, flashlight, batteries, and important documents.</p>
                </div>
                <div class="tip-card animate-fade-in-delay">
                    <div class="tip-icon">ğŸ“</div>
                    <h3>Stay Informed</h3>
                    <p>Monitor local weather reports and flood warnings. Sign up for community alerts and emergency notifications.</p>
                </div>
                <div class="tip-card animate-slide-up-delay">
                    <div class="tip-icon">ğŸš¶â€â™‚ï¸</div>
                    <h3>Evacuation Plan</h3>
                    <p>Know your evacuation routes and have a family communication plan. Never walk, swim, or drive through flood waters.</p>
                </div>
                <div class="tip-card animate-fade-in-delay-2">
                    <div class="tip-icon">ğŸ”Œ</div>
                    <h3>Electrical Safety</h3>
                    <p>Avoid contact with electrical equipment in wet areas. Turn off utilities if instructed by authorities.</p>
                </div>
                <div class="tip-card animate-slide-up-delay-2">
                    <div class="tip-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <h3>Help Others</h3>
                    <p>Check on neighbors, especially elderly or disabled residents. Report flooded roads and help direct traffic.</p>
                </div>
            </div>
        </div>

        <div class="features">
            <div class="feature-card">
                <h3>ğŸ“¢ Real-time Alerts</h3>
                <p>Receive instant notifications about flood risks, weather changes, and emergency situations in your area.</p>
            </div>
            <div class="feature-card">
                <h3>ğŸ‘¥ Community Reports</h3>
                <p>Share and verify community-sourced reports about flooding, damage, and local conditions.</p>
            </div>
            <div class="feature-card">
                <h3>ğŸ“Š Data Dashboard</h3>
                <p>Access comprehensive dashboards with sensor data, weather information, and flood statistics.</p>
            </div>
        </div>

        <div class="api-section">
            <h2>ğŸš€ API Endpoints</h2>
            <div class="api-endpoints">
                <div class="api-endpoint">
                    <strong>Alerts API</strong><br>
                    <code>GET /api/alerts/</code> - List active alerts<br>
                    <code>POST /api/alerts/create/</code> - Create new alert
                </div>
                <div class="api-endpoint">
                    <strong>Community API</strong><br>
                    <code>GET /api/community/reports/</code> - List reports<br>
                    <code>POST /api/community/reports/create/</code> - Submit report
                </div>
                <div class="api-endpoint">
                    <strong>Dashboard API</strong><br>
                    <code>GET /api/dashboard/widgets/alerts/</code> - Alert data<br>
                    <code>GET /api/dashboard/widgets/weather/</code> - Weather data
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Built with Django & IBM Technology Stack â€¢ Real-time Flood Monitoring for Communities</p>
        </div>
    </div>
</body>
</html>
